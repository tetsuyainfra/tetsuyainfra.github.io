<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.5.0"/><style data-href="/styles.d7d66a287b58a4c103ba.css" data-identity="gatsby-global-css">.layout-module--container--78b04{font-family:sans-serif;margin:auto;max-width:500px}.layout-module--heading--f158c{background-color:#639;color:#fff}.layout-module--nav-links--1113b{display:flex;list-style:none;padding-left:0}.layout-module--nav-link-item--a5f0a{padding-right:2rem}.layout-module--nav-link-text--69cda{color:#000}.layout-module--site-title--e4dea{color:gray;font-size:3rem;font-weight:700;margin:3rem 0}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-gatsby-head="true">My Blog Posts | tetsuyainfra 日々是好日</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--container--78b04"><header class="layout-module--site-title--e4dea">tetsuyainfra 日々是好日</header><nav><ul class="layout-module--nav-links--1113b"><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/">Home</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/about/">About</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/blog/">Blog</a></li></ul></nav><main><h1 class="layout-module--heading--f158c">tetsuyainfra 日々是好日</h1><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">おうち Hyper-V Server</h1><p>February 20, 2022</p></header><section itemProp="articleBody"><h2>注意</h2>
<ul>
<li>GUI はない</li>
<li>リモート管理が前提</li>
<li>おうちで使ってみる場合、インストールメディア(USB メモリ)に一緒に WindowsAdminCenter の MSI を保存 → そのままインストール
<ul>
<li>ブラウザから設定が一番楽ではないか</li>
</ul>
</li>
</ul>
<h2>参考</h2>
<h2>準備物</h2>
<ul>
<li>公式 ISO
<a href="https://www.microsoft.com/ja-jp/evalcenter/evaluate-hyper-v-server-2019">https://www.microsoft.com/ja-jp/evalcenter/evaluate-hyper-v-server-2019</a></li>
</ul>
<h2>インストール</h2>
<p>普通のインストールと同じであるちょっとだけスクリーンショットを</p>
<h2>OpenSSH Server for Windows を有効化する</h2>
<p><a href="https://docs.microsoft.com/ja-jp/windows-server/administration/openssh/openssh_install_firstuse">https://docs.microsoft.com/ja-jp/windows-server/administration/openssh/openssh_install_firstuse</a></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> Get-WindowsCapability -Online | Where-Object Name -Like "OpenSSH*"
> Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
Path          :
Online        : True
RestartNeeded : False

> Start-Service sshd
> Set-Service -Name sshd -StartupType 'Automatic'

# 確認
> Get-NetFirewallRule -Name "OpenSSH*"
# 作成と有効化(とりあえずデフォルトで有効になっている模様)
> New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22

# C:\ProgramData\ssh\sshd_configをnotepadで編集する(CLIで使えるテキストエディタが無いのでRemoteDesktopでアクセス)
# 下を追記してRootLoginを禁止する
DenyUsers administrator
# DenyGroups Administratorsはどうなのかな・・・

> Restart-Service sshd

# 公開鍵認証も追加すればいける
> mkdir .ssh
> echo ssh-ed25519 HOGEHOGE >> .ssh/authorized_keys

# sshd_configにAdministratorsグループに対する設定があるので注意
# Match Group administrators
#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys
# 手順
> echo ssh-ed25519 HOGEHOGE >> >> %PROGRAMDATA%\ssh\administrators_authorized_keys
> icacls.exe "C:\ProgramData\ssh\administrators_authorized_keys" /inheritance:r /grant "Administrators:F" /grant "SYSTEM:F"
</code></pre></div>
<h2>WinRM で異なるセグメントからの操作を許可する</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> Get-NetFirewallRule -Name "WinRM*"
> Get-NetFirewallRule -Name "WinRM*" | Get-NetFirewallAddressFilter
> Get-NetFirewallRule -Name "WINRM-HTTP-IN-TCP-PUBLIC" | Get-NetFirewallAddressFilter

LocalAddress  : Any
RemoteAddress : LocalSubnet
> Set-NetFirewallRule -Name "WINRM-HTTP-In-TCP-PUBLIC" -RemoteAddress LocalSubnet,192.168.10.0/24</code></pre></div>
<h2>Windows Admin Center を入れてみる</h2>
<p>scp でファイル送っておく</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># c:\ ルートに送る
> scp WindowsAdminCenter2110.msi tetsuyainfra@hv2019sv.local:\
        1 file(s) copied.</code></pre></div></section><hr/><footer></footer></article> <nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blog/2021/01/31/今日(2/1)のメモ/">← <!-- -->今日(2/1)のメモ</a></li><li><a rel="next" href="/blog/2022/03/23/Vampire Survivors バニラ ３ステージクリア @v0.3.1/">Vampire Survivors バニラ ３ステージクリア @v0.3.1<!-- --> →</a></li></ul></nav></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2022/02/19/おうち Hyper-V Server/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-e21ac12a53ec630385e8.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-9fbe192c31efe1101099.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-b6976e3a3ed45ee75a1c.js\"],\"component---src-pages-blog-archive-tsx\":[\"/component---src-pages-blog-archive-tsx-b144834444dc0dc207cb.js\"],\"component---src-pages-blog-index-tsx\":[\"/component---src-pages-blog-index-tsx-6d7a31bdc3788dc22793.js\"],\"component---src-pages-blog-templates-blog-monthly-tsx\":[\"/component---src-pages-blog-templates-blog-monthly-tsx-3738632fa33926d89a2e.js\"],\"component---src-pages-blog-templates-blog-post-tsx\":[\"/component---src-pages-blog-templates-blog-post-tsx-33d073a22e4b51359daa.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-aa4f90b54f6184fec03e.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="40c0bcca2e37513017c3";</script><script src="/webpack-runtime-ed84b518a92c4284556a.js" async></script><script src="/framework-a2456b482bed9d590fcf.js" async></script><script src="/app-e21ac12a53ec630385e8.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>