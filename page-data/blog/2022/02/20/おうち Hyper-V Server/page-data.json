{"componentChunkName":"component---src-pages-blog-blog-post-tsx-content-file-path-home-runner-work-blog-blog-contents-blog-2022-02-20-hyperv-server-2019-md","path":"/blog/2022/02/20/おうち Hyper-V Server/","result":{"data":{"mdx":{"id":"0650bb16-e583-524c-92e9-36a694025ebb","body":"\n## 注意\n\n- GUI はない\n- リモート管理が前提\n- おうちで使ってみる場合、インストールメディア(USB メモリ)に一緒に WindowsAdminCenter の MSI を保存 → そのままインストール\n  - ブラウザから設定が一番楽ではないか\n\n## 参考\n\n## 準備物\n\n- 公式 ISO\n  https://www.microsoft.com/ja-jp/evalcenter/evaluate-hyper-v-server-2019\n\n## インストール\n\n普通のインストールと同じであるちょっとだけスクリーンショットを\n\n## OpenSSH Server for Windows を有効化する\n\nhttps://docs.microsoft.com/ja-jp/windows-server/administration/openssh/openssh_install_firstuse\n\n```\n> Get-WindowsCapability -Online | Where-Object Name -Like \"OpenSSH*\"\n> Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0\nPath          :\nOnline        : True\nRestartNeeded : False\n\n> Start-Service sshd\n> Set-Service -Name sshd -StartupType 'Automatic'\n\n# 確認\n> Get-NetFirewallRule -Name \"OpenSSH*\"\n# 作成と有効化(とりあえずデフォルトで有効になっている模様)\n> New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22\n\n# C:\\ProgramData\\ssh\\sshd_configをnotepadで編集する(CLIで使えるテキストエディタが無いのでRemoteDesktopでアクセス)\n# 下を追記してRootLoginを禁止する\nDenyUsers administrator\n# DenyGroups Administratorsはどうなのかな・・・\n\n> Restart-Service sshd\n\n# 公開鍵認証も追加すればいける\n> mkdir .ssh\n> echo ssh-ed25519 HOGEHOGE >> .ssh/authorized_keys\n\n# sshd_configにAdministratorsグループに対する設定があるので注意\n# Match Group administrators\n#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys\n# 手順\n> echo ssh-ed25519 HOGEHOGE >> >> %PROGRAMDATA%\\ssh\\administrators_authorized_keys\n> icacls.exe \"C:\\ProgramData\\ssh\\administrators_authorized_keys\" /inheritance:r /grant \"Administrators:F\" /grant \"SYSTEM:F\"\n\n```\n\n## WinRM で異なるセグメントからの操作を許可する\n\n```\n> Get-NetFirewallRule -Name \"WinRM*\"\n> Get-NetFirewallRule -Name \"WinRM*\" | Get-NetFirewallAddressFilter\n> Get-NetFirewallRule -Name \"WINRM-HTTP-IN-TCP-PUBLIC\" | Get-NetFirewallAddressFilter\n\nLocalAddress  : Any\nRemoteAddress : LocalSubnet\n> Set-NetFirewallRule -Name \"WINRM-HTTP-In-TCP-PUBLIC\" -RemoteAddress LocalSubnet,192.168.10.0/24\n```\n\n## Windows Admin Center を入れてみる\n\nscp でファイル送っておく\n\n```\n# c:\\ ルートに送る\n> scp WindowsAdminCenter2110.msi tetsuyainfra@hv2019sv.local:\\\n        1 file(s) copied.\n```\n","tableOfContents":{"items":[{"url":"#注意","title":"注意"},{"url":"#参考","title":"参考"},{"url":"#準備物","title":"準備物"},{"url":"#インストール","title":"インストール"},{"url":"#openssh-server-for-windows-を有効化する","title":"OpenSSH Server for Windows を有効化する"},{"url":"#winrm-で異なるセグメントからの操作を許可する","title":"WinRM で異なるセグメントからの操作を許可する"},{"url":"#windows-admin-center-を入れてみる","title":"Windows Admin Center を入れてみる"}]},"frontmatter":{"title":"おうち Hyper-V Server","date":"February 20, 2022"}},"previous":{"fields":{"url":"/blog/2021/02/01/今日(2/1)のメモ"},"frontmatter":{"title":"今日(2/1)のメモ"}},"next":{"fields":{"url":"/blog/2022/03/24/Vampire Survivors バニラ ３ステージクリア @v0.3.1"},"frontmatter":{"title":"Vampire Survivors バニラ ３ステージクリア @v0.3.1"}}},"pageContext":{"id":"0650bb16-e583-524c-92e9-36a694025ebb","previousPostId":"854a2307-1742-50cc-8a38-b531ff368591","nextPostId":"ef27fe2f-55c0-5660-a5fe-0e1500c97741","frontmatter":{"title":"おうち Hyper-V Server","permalink":"home_hyper-v","date":"2022-02-20T00:00:00.000Z","category":"Diary","tag":["Hyper-V","devops"]}}},"staticQueryHashes":["3061276955"],"slicesMap":{}}