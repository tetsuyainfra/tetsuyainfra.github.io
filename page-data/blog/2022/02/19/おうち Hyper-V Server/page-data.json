{"componentChunkName":"component---src-pages-blog-templates-blog-post-tsx","path":"/blog/2022/02/19/おうち Hyper-V Server/","result":{"data":{"site":{"siteMetadata":{"title":"tetsuyainfra 日々是好日"}},"markdownRemark":{"id":"3dcd34eb-9a3e-54d1-ad50-10918235c8c8","html":"<h2>注意</h2>\n<ul>\n<li>GUI はない</li>\n<li>リモート管理が前提</li>\n<li>おうちで使ってみる場合、インストールメディア(USB メモリ)に一緒に WindowsAdminCenter の MSI を保存 → そのままインストール\n<ul>\n<li>ブラウザから設定が一番楽ではないか</li>\n</ul>\n</li>\n</ul>\n<h2>参考</h2>\n<h2>準備物</h2>\n<ul>\n<li>公式 ISO\n<a href=\"https://www.microsoft.com/ja-jp/evalcenter/evaluate-hyper-v-server-2019\">https://www.microsoft.com/ja-jp/evalcenter/evaluate-hyper-v-server-2019</a></li>\n</ul>\n<h2>インストール</h2>\n<p>普通のインストールと同じであるちょっとだけスクリーンショットを</p>\n<h2>OpenSSH Server for Windows を有効化する</h2>\n<p><a href=\"https://docs.microsoft.com/ja-jp/windows-server/administration/openssh/openssh_install_firstuse\">https://docs.microsoft.com/ja-jp/windows-server/administration/openssh/openssh_install_firstuse</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> Get-WindowsCapability -Online | Where-Object Name -Like \"OpenSSH*\"\n> Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0\nPath          :\nOnline        : True\nRestartNeeded : False\n\n> Start-Service sshd\n> Set-Service -Name sshd -StartupType 'Automatic'\n\n# 確認\n> Get-NetFirewallRule -Name \"OpenSSH*\"\n# 作成と有効化(とりあえずデフォルトで有効になっている模様)\n> New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22\n\n# C:\\ProgramData\\ssh\\sshd_configをnotepadで編集する(CLIで使えるテキストエディタが無いのでRemoteDesktopでアクセス)\n# 下を追記してRootLoginを禁止する\nDenyUsers administrator\n# DenyGroups Administratorsはどうなのかな・・・\n\n> Restart-Service sshd\n\n# 公開鍵認証も追加すればいける\n> mkdir .ssh\n> echo ssh-ed25519 HOGEHOGE >> .ssh/authorized_keys\n\n# sshd_configにAdministratorsグループに対する設定があるので注意\n# Match Group administrators\n#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys\n# 手順\n> echo ssh-ed25519 HOGEHOGE >> >> %PROGRAMDATA%\\ssh\\administrators_authorized_keys\n> icacls.exe \"C:\\ProgramData\\ssh\\administrators_authorized_keys\" /inheritance:r /grant \"Administrators:F\" /grant \"SYSTEM:F\"\n</code></pre></div>\n<h2>WinRM で異なるセグメントからの操作を許可する</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> Get-NetFirewallRule -Name \"WinRM*\"\n> Get-NetFirewallRule -Name \"WinRM*\" | Get-NetFirewallAddressFilter\n> Get-NetFirewallRule -Name \"WINRM-HTTP-IN-TCP-PUBLIC\" | Get-NetFirewallAddressFilter\n\nLocalAddress  : Any\nRemoteAddress : LocalSubnet\n> Set-NetFirewallRule -Name \"WINRM-HTTP-In-TCP-PUBLIC\" -RemoteAddress LocalSubnet,192.168.10.0/24</code></pre></div>\n<h2>Windows Admin Center を入れてみる</h2>\n<p>scp でファイル送っておく</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># c:\\ ルートに送る\n> scp WindowsAdminCenter2110.msi tetsuyainfra@hv2019sv.local:\\\n        1 file(s) copied.</code></pre></div>","frontmatter":{"title":"おうち Hyper-V Server","date":"February 20, 2022"}},"previous":{"fields":{"url":"/blog/2021/01/31/今日(2/1)のメモ"},"frontmatter":{"title":"今日(2/1)のメモ"}},"next":{"fields":{"url":"/blog/2022/03/23/Vampire Survivors バニラ ３ステージクリア @v0.3.1"},"frontmatter":{"title":"Vampire Survivors バニラ ３ステージクリア @v0.3.1"}}},"pageContext":{"id":"3dcd34eb-9a3e-54d1-ad50-10918235c8c8","previousPostId":"399fac83-28fd-5b49-9938-0787ceb88c2d","nextPostId":"9ba1d860-d4af-510a-bdaf-c0f3a886e829"}},"staticQueryHashes":["3159585216","783589756"],"slicesMap":{}}